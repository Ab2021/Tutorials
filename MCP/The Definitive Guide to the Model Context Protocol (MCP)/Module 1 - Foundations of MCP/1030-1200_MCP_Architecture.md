
# The Definitive Guide to the Model Context Protocol (MCP)

## Module 1: Foundations of MCP

### Lesson 1.2: The MCP Architecture (10:30 - 12:00)

---

### **1. The Three Core Components: A Symphony of Specialization**

The elegance of the Model Context Protocol (MCP) lies in its simplicity and the clear separation of concerns it enforces. The entire architecture is built upon three distinct, specialized components that work in concert to create a secure and powerful bridge between the user, the AI, and the available tools. Understanding the precise role of each component is fundamental to mastering MCP.

These components are not just abstract concepts; they are concrete roles that map directly to the software you will build or interact with. They are the Host, the MCP Client, and the MCP Server.

#### **Component 1: The Host - The User's World**

**Definition:** The Host is the end-user application. It is the tangible environment that the user directly sees and interacts with. The Host is the master of the user experience (UX) and the ultimate arbiter of what is presented to the user.

**Key Responsibilities:**

*   **User Interface (UI):** The Host is responsible for rendering the entire user interface. This could be the text editor in an IDE, the chat window in a web application, the dashboard of a desktop app, or the command line prompt in a terminal.
*   **User Input:** It captures all user input, whether it's a typed command, a mouse click, a voice command, or a file being dragged and dropped into the application.
*   **State Management:** The Host maintains the state of the application. It knows which files are open, which chat session is active, and what the user is currently focused on.
*   **Hosting the MCP Client:** Crucially, the Host application contains and manages the lifecycle of the MCP Client. The Client is a part of the Host, but the Host is its container.

**Examples of Hosts:**

*   **An Integrated Development Environment (IDE):** Think of Visual Studio Code, JetBrains Fleet, or Cursor. The IDE itself is the Host. It provides the text editor, the file explorer, the terminal, and it is the environment within which the AI's capabilities are exposed.
*   **A Web-Based Chat Application:** A platform like ChatGPT or a custom-built internal support bot. The web browser renders the Host application, which consists of the chat history, the input box, and other UI elements.
*   **A Desktop Application:** A data analysis tool like Tableau or a design tool like Figma could act as a Host, integrating AI capabilities to help users create and analyze content.
*   **A Command-Line Interface (CLI):** A CLI tool that uses AI to provide enhanced functionality (e.g., a natural language interface to `git`) is also a Host.

**The Host's Perspective:** From the Host's point of view, MCP is a way to augment its functionality. It offloads the responsibility of providing tools and data to external services (MCP Servers) so it can focus on its core job: providing a great user experience. The Host doesn't need to know *how* a tool works; it only needs to know that the tool is available and how to call it through its embedded MCP Client.

#### **Component 2: The MCP Client - The Secure Intermediary**

**Definition:** The MCP Client is the component, living within the Host, that speaks the MCP language (JSON-RPC 2.0). It acts as a secure, intelligent intermediary, managing all communication between the Host application and one or more MCP Servers. It is the engine of the protocol.

**Key Responsibilities:**

*   **Connection Management:** The Client is responsible for establishing, maintaining, and tearing down the connection to an MCP Server. This includes launching local server processes or connecting to remote HTTP endpoints.
*   **Speaking JSON-RPC:** It constructs, sends, and receives valid JSON-RPC 2.0 messages (Requests, Responses, and Notifications).
*   **Capability Discovery:** The Client is responsible for querying the Server to discover what capabilities (tools, resources, prompts) it offers. It then makes this information available to the Host and, potentially, to the LLM.
*   **Enforcing Security:** The Client is a critical part of the security model. It is responsible for:
    *   **Sandboxing:** Passing the correct "root" URIs to the server to restrict its access.
    *   **Permissions:** Intercepting requests for potentially dangerous actions and asking the Host to prompt the user for confirmation.
    *   **Token Management:** Ensuring that authentication tokens are sent to the correct, intended audience (more on this in Module 6).
*   **Orchestration:** The Client often orchestrates the complex dance between the user, the LLM, and the MCP Server. For example, it might receive a user query, send it to the LLM along with a list of tools, receive a tool call request from the LLM, send that request to the server, receive the result, and then send that result back to the LLM for final processing.

**The Client's Perspective:** The Client is the heart of the MCP implementation on the application side. It is a busy, multi-talented component that juggles communication, security, and orchestration. It is the gatekeeper and the translator, ensuring that all interactions are safe, efficient, and compliant with the protocol.

#### **Component 3: The MCP Server - The Tool Provider**

**Definition:** The MCP Server is a backend service that provides the actual data and tools. It is the component that does the "real work." The server exposes a set of capabilities that can be discovered and invoked by an MCP Client.

**Key Responsibilities:**

*   **Implementing Capabilities:** The Server contains the actual logic for the tools, resources, and prompts it offers.
    *   For a **tool**, this means writing the code that executes an action (e.g., calling a third-party API, running a database query, modifying a file).
    *   For a **resource**, this means writing the code that fetches and returns data (e.g., reading a file, querying a database for a specific record).
    *   For a **prompt**, this means defining the template and the logic for generating a prompt for the LLM.
*   **Exposing Capabilities:** The Server must respond to the Client's discovery requests (`tools/list`, `resources/list`, `prompts/list`) with a clear, machine-readable description of its capabilities, including their names, descriptions, and input schemas.
*   **Handling Requests:** The Server listens for incoming JSON-RPC requests from the Client, validates them, executes the corresponding logic, and returns a well-formed JSON-RPC response.
*   **Sending Notifications:** The Server can proactively send notifications to the Client to inform it of events, such as a change in a resource (e.g., a file has been updated on disk).

**Types of Servers:**

*   **Local Executable:** The server can be a simple executable file that the Client launches as a subprocess. They communicate over standard I/O (`stdio`). This is very common for development tools.
*   **Remote HTTP Service:** The server can be a web server that listens for HTTP requests from the Client. This is the standard for web-based applications or for providing shared, centralized tools within an organization.

**The Server's Perspective:** The Server's job is to be a specialist. It does one thing (or a small set of related things) and does it well. A good MCP Server is a self-contained, reusable microservice. It doesn't know or care about the Host application or the LLM. It simply exposes its capabilities via the MCP protocol and waits for a compliant Client to call them. This decoupling is what makes the architecture so powerful and scalable.

---

### **2. The Connection Model: A Secure 1:1 Relationship**

A foundational principle of MCP is the **strict 1:1 relationship** between a single MCP Client and a single MCP Server for any given session. A Host application can certainly connect to *multiple* different MCP Servers simultaneously, but each connection is its own isolated, independent session.

**Client A <---> Server X**
**Client A <---> Server Y**
**Client A <---> Server Z**

This is not:

**Client A ---> Server Pool <--- Client B**

**Why is this 1:1 model so important?**

1.  **Security and Isolation:** It ensures that the context and permissions for one session cannot leak into another. When a Client connects to a Server and provides a set of root URIs for sandboxing, that security context applies *only* to that specific connection. There is no risk of another client or another session accidentally gaining access to those permissions.
2.  **State Management:** While the modern MCP-over-HTTP model encourages stateless servers, the 1:1 connection model allows for state to be maintained securely when necessary. For example, a server that needs to perform a complex, multi-step workflow can be confident that all related requests are coming from the same client.
3.  **Simplicity and Clarity:** The 1:1 model is easy to reason about. Developers can think of each connection as a clean, independent pipe. This simplifies debugging and reduces the cognitive overhead of building and maintaining MCP applications.

This model provides the best of both worlds: the Host can compose a rich set of functionalities by connecting to many specialized servers, while each individual connection remains simple, secure, and isolated.

---

### **3. Visualizing the Flow: A Complete Walkthrough**

Let's trace a complete interaction from beginning to end to see how the three components work together. We'll use our earlier example: an AI-powered IDE (the Host) that will use a `git` MCP server to create a commit message.

**Scenario:** The user has staged some changes in their git repository and types into the IDE's chat window: "`/commit` Write a commit message for my changes."

**The Players:**

*   **Host:** The IDE application.
*   **MCP Client:** Embedded within the IDE.
*   **MCP Server:** A local executable, `git-mcp-server`, that provides `git`-related tools.

**(ASCII Art Diagram of the Flow)**

```
+------------------+        +------------------+        +--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|      User      |        |    Host / Client   |        |  MCP Server (git)  |
+------------------+        +------------------+        +--------------------+
        |                  |        |                  |        |                    |
        | 1. User Input    |------->| 2. Launch Server |        |                    |
        | `/commit`        |        | & Connect        |------->| 3. Server Ready    |
        |                  |        |                  |        |                    |
        |                  |        | 4. Discover Caps |------->| 5. Return Caps     |
        |                  |        | (prompts/list)   |        | (commit-prompt)    |
        |                  |        |                  |        |                    |
        |                  |        | 6. Get Resource  |------->| 7. Provide Diff    |
        |                  |        | (git/diff)       |        | (diff content)     |
        |                  |        |                  |        |                    |
        | 8. LLM Call      |        |                  |        |                    |
        | (Prompt + Diff)  |        |                  |        |                    |
        |                  |        |                  |        |                    |
        | 9. LLM Response  |        |                  |        |                    |
        | (Commit Msg)     |        |                  |        |                    |
        |                  |        |                  |        |                    |
        | 10. Display Msg  |<-------| (Final Result)   |        |                    |
        |                  |        |                  |        |                    |

```

**Step-by-Step Breakdown:**

1.  **User Input:** The user types `/commit` in the Host (the IDE). The Host recognizes this as a command associated with a specific MCP prompt.

2.  **Launch and Connect:** The Host's embedded MCP Client checks if it's already connected to the `git-mcp-server`. If not, it launches the `git-mcp-server` executable as a subprocess and establishes a connection over `stdio`. This is the **Handshake** phase.

3.  **Server Ready:** The `git-mcp-server` starts up and begins listening for JSON-RPC messages on its standard input.

4.  **Discovery (Optional but Recommended):** Upon connection (or ahead of time), the Client sends a `prompts/list` request to the server to learn about the available prompts. This is the **Discovery** phase.

5.  **Return Capabilities:** The Server responds with a list of all its prompts, including one named `git-commit-message` that takes a resource argument named `diff`.

6.  **Get Contextual Resource:** The logic for the `/commit` command knows that the `git-commit-message` prompt needs the output of `git diff --staged`. The Client invokes the `resources/get` method on the server, requesting the resource with the URI `git:/diff/staged`.

7.  **Provide Resource:** The `git-mcp-server` receives the request. Its handler for this resource runs the command `git diff --staged`, captures the output, and returns it as the result of the `resources/get` call.

8.  **LLM Call (Sampling):** Now the Client has everything it needs. It constructs a prompt for the LLM. This prompt contains the instructions from the `git-commit-message` prompt definition and the `diff` content it just fetched. It sends this to the LLM API.

9.  **LLM Response:** The LLM processes the prompt and the diff and generates a well-formatted commit message.

10. **Display to User:** The Client receives the commit message from the LLM. It passes this result back to the Host. The Host then displays the generated commit message in the UI, perhaps in a new editor window, for the user to review, edit, and approve.

This entire flow happens in a fraction of a second, but it perfectly illustrates the separation of concerns. The Host manages the UI, the Server manages the `git` logic, and the Client securely orchestrates the communication between them, with the LLM providing the intelligence to transform the data. This is the power and elegance of the MCP architecture.
